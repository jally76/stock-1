@model Stock.Core.Dto.UserDto
@{
    ViewBag.Title = "Stock";
}

<div class="row">
    <div class="col-md-4">
        
        <input id="tags">
        <input id="companyId" type="hidden">
        <button type="button" class="btn btn-primary" id="add-ticker">Add ticker</button>
    </div>
    <div class="col-md-4">
        @Html.DisplayFor(m => m.Name)
        @Html.DisplayFor(m => m.Email)

        @foreach (var ticker in Model.Tickers)
        {
            @ticker.Company @ticker.Code
            <br>

        }
    </div>
    <div class="col-md-4">

    </div>
</div>

@section scripts {
    <script type="text/javascript">
        //$(function () {
        //    function split(val) {
        //        return val.split(/,\s*/);
        //    }
        //    function extractLast(term) {
        //        return split(term).pop();
        //    }

        //    $("#tags")
        //      // don't navigate away from the field on tab when selecting an item
        //      .on("keydown", function (event) {
        //          if (event.keyCode === $.ui.keyCode.TAB &&
        //              $(this).autocomplete("instance").menu.active) {
        //              event.preventDefault();
        //          }
        //      })
        //      .autocomplete({
        //          source: function (request, response) {

        //              $.getJSON("/Home/CompaniesList", {
        //                  subString: extractLast(request.term)
        //              }, response);
        //          },
        //          search: function () {
        //              // custom minLength
        //              var term = extractLast(this.value);
        //              if (term.length < 2) {
        //                  return false;
        //              }
        //          },
        //          focus: function () {
        //              // prevent value inserted on focus
        //              return false;
        //          },
        //          select: function (event, ui) {
        //              var terms = split(this.value);
        //              // remove the current input
        //              terms.pop();
        //              // add the selected item
        //              terms.push(ui.item.value);
        //              // add placeholder to get the comma-and-space at the end
        //              terms.push("");
        //              this.value = terms.join(", ");
        //              return false;
        //          }
        //      });
        //});

        $(function () {

            $("#add-ticker").click(function (event) {

                $.ajax({
                    url: "/Home/AddTicker",
                    data: { companyId: $('#companyId').val() }
                })
                .success(function (data) {
                    alert(data.Message);
                });

            });

            $("#tags").autocomplete({
                minLength: 2,
                source: function (request, response) {
                    $.getJSON("/Home/CompaniesList", {
                            subString: request.term
                    },
                    function (data) {
                        var itemList = [];

                        $.each(data, function (key, val) {
                            var item = {
                                value: val.Id,
                                label: val.Name
                            };

                            itemList.push(item);
                        });

                        console.log(itemList); // Shows correct results
                        response(itemList);
                    });
                },
                select: function (event, ui) {
                    $('#companyId').val(ui.item.value);
                    $('#tags').val(ui.item.label);
                    return false;
                }
            });
        } );
    </script>
}